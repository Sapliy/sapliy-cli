"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[87],{8621:(e,t,a)=>{a.d(t,{n:()=>l});var o=a(9827),n=a(709);let i={admin:4,finance:3,developer:2,viewer:1},l=(0,o.v)()((0,n.Zr)((e,t)=>({user:null,organization:null,zone:null,zones:[],environment:"test",accessToken:null,isLoading:!1,error:null,setUser:t=>e({user:t}),setOrganization:t=>e({organization:t}),setZone:t=>e({zone:t,environment:(null==t?void 0:t.mode)||"test"}),setZones:t=>e({zones:t}),setEnvironment:t=>e({environment:t}),setAccessToken:t=>e({accessToken:t}),setLoading:t=>e({isLoading:t}),setError:t=>e({error:t}),login:async(e,a)=>{let{setLoading:o,setError:n,setUser:i,setAccessToken:l}=t();o(!0),n(null);try{let t=await fetch("".concat("http://localhost:3000/api/auth","/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:a})});if(!t.ok)throw Error("Invalid credentials");let o=await t.json();l(o.access_token),i({id:o.user.id,email:o.user.email,name:o.user.name||e.split("@")[0],role:o.user.role||"developer"})}catch(e){throw n(e instanceof Error?e.message:"Login failed"),e}finally{o(!1)}},logout:()=>{e({user:null,organization:null,zone:null,zones:[],accessToken:null,error:null})},hasRole:e=>{let{user:a}=t();return!!a&&i[a.role]>=i[e]},canEdit:()=>{let{user:e}=t();return!!e&&["admin","finance","developer"].includes(e.role)},isAdmin:()=>{let{user:e}=t();return(null==e?void 0:e.role)==="admin"}}),{name:"fintech-auth-storage",partialize:e=>({accessToken:e.accessToken,user:e.user,organization:e.organization,zone:e.zone,zones:e.zones,environment:e.environment})}))},7087:(e,t,a)=>{a.d(t,{h:()=>s});var o=a(9827),n=a(709),i=a(4035),l=a(8621);let r=[{id:"tmpl_kyc",name:"KYC & AML Checks",description:"Automated KYC verification with risk scoring and manual approval for high-risk users.",is_template:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),tags:["Compliance","Onboarding"],nodes:[{id:"1",type:"eventTrigger",position:{x:100,y:100},data:{source:"system",type:"user.signup",payloadSchema:{}}},{id:"2",type:"filter",position:{x:400,y:100},data:{operator:">",filterValue:80,property:"risk_score"}},{id:"3",type:"approval",position:{x:700,y:50},data:{approverRole:"compliance",timeoutMinutes:60}}],edges:[{id:"e1-2",source:"1",target:"2"},{id:"e2-3",source:"2",target:"3"}]},{id:"tmpl_fraud",name:"High-Value Transaction Alert",description:"Monitor transactions > $10k and send alerts to Slack and audit logs.",is_template:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),tags:["Fraud","Monitoring"],nodes:[{id:"1",type:"eventTrigger",position:{x:100,y:100},data:{source:"stripe",type:"payment.succeeded"}},{id:"2",type:"filter",position:{x:400,y:100},data:{operator:">",filterValue:1e4}},{id:"3",type:"notification",position:{x:700,y:100},data:{channel:"slack",message:"High value txn detected!"}}],edges:[{id:"e1-2",source:"1",target:"2"},{id:"e2-3",source:"2",target:"3"}]}],s=(0,o.v)()((0,n.Zr)((e,t)=>({currentFlowId:null,currentFlowName:"Untitled Flow",isSaving:!1,savedFlows:[],templates:[],internalTemplates:r,setCurrentFlow:(a,o)=>e({currentFlowId:a,currentFlowName:o||t().currentFlowName}),loadFlows:async()=>{let{zone:t}=l.n.getState();if(t)try{let a=await fetch("".concat("http://localhost:3000/api/auth","/flows?zone_id=").concat(t.id));if(a.ok){let t=await a.json();e({savedFlows:t})}}catch(e){console.error("Failed to load flows:",e)}},loadTemplates:async()=>{e({templates:r.map(e=>({id:e.id,name:e.name,description:e.description,is_template:e.is_template,created_at:e.created_at,updated_at:e.updated_at,tags:e.tags,nodeCount:e.nodes.length}))})},saveCurrentFlow:async()=>{e({isSaving:!0});let{nodes:a,edges:o}=i.R.getState(),{currentFlowId:n,currentFlowName:r}=t(),{organization:s,zone:d}=l.n.getState();if(!d||!s)throw console.error("Missing zone or organization"),e({isSaving:!1}),Error("Missing zone or organization");let c={id:n||"fl_".concat(Math.random().toString(36).substr(2,9)),name:r,org_id:s.id,zone_id:d.id,nodes:a,edges:o,enabled:!0};try{let a=await fetch("".concat("http://localhost:3000/api/auth","/flows"),{method:n?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(!a.ok){let e=await a.json();throw Error(e.message||"Failed to save flow")}let o=await a.json();e({currentFlowId:o.id||c.id,isSaving:!1}),await t().loadFlows()}catch(t){throw console.error("Failed to save flow:",t),e({isSaving:!1}),t}},loadFlowConfig:async function(a){let o,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(n)o=t().internalTemplates.find(e=>e.id===a);else try{let e=await fetch("".concat("http://localhost:3000/api/auth","/flows?id=").concat(a));e.ok&&(o=await e.json())}catch(e){console.error("Failed to load flow config:",e)}if(o){let{setNodes:t,setEdges:a}=i.R.getState();t(o.nodes||[]),a(o.edges||[]),e({currentFlowId:n?null:o.id,currentFlowName:n?"Copy of ".concat(o.name):o.name})}},createNewFlow:async(a,o)=>{let{setNodes:n,setEdges:l}=i.R.getState();o?(await t().loadFlowConfig(o,!0),e({currentFlowName:a||"Copy of Template"})):(n([]),l([]),e({currentFlowId:null,currentFlowName:a}))}}),{name:"fintech-flow-storage",partialize:e=>({savedFlows:e.savedFlows})}))},4035:(e,t,a)=>{a.d(t,{R:()=>l});var o=a(9827),n=a(1077),i=a(3403);let l=(0,o.v)((e,t)=>({contextMenu:null,nodeDetails:null,nodes:[],edges:[],setContextMenu:t=>{e({contextMenu:t})},onNodesChange:a=>{e({nodes:(0,n._0)(a,t().nodes)})},onEdgesChange:a=>{e({edges:(0,n.zW)(a,t().edges)})},onConnect:a=>{e({edges:(0,i.rN)({...a,type:"custom",animated:!0},t().edges)});let o=t().nodes.find(e=>e.id===a.source);o&&"sensor"===o.type&&e({nodes:t().nodes.map(e=>e.id===a.target?{...e,data:{...e.data,sourcesourceNode:o.data}}:e)})},setNodes:t=>{e({nodes:t})},setEdges:t=>{e(()=>({edges:t}))},removeEdge:a=>{let o=t().edges.find(e=>e.id===a);e(e=>({edges:e.edges.filter(e=>e.id!==a),nodes:e.nodes.map(e=>e.id===(null==o?void 0:o.target)?{...e,data:{...e.data,value:null}}:e)}))},onNodeContextMenu:(e,a,o)=>{e.preventDefault();let n=o.current?o.current.getBoundingClientRect():{width:0,height:0};t().setContextMenu({id:a.id,top:e.clientY<n.height-200&&e.clientY,left:e.clientX<n.width-200&&e.clientX,right:e.clientX>=n.width-200&&n.width-e.clientX,bottom:e.clientY>=n.height-200&&n.height-e.clientY})},deleteNode:t=>{e(e=>({nodes:e.nodes.filter(e=>e.id!==t)})),e({contextMenu:null})},duplicateNode:t=>{e(e=>{var a,o;let n=e.nodes.find(e=>e.id===t);if(!n)return e;let i={...n,id:"".concat(n.id,"-copy"),position:{x:n.position.x+100,y:n.position.y+100},value:"idle",data:"actuator"===n.type?{...n.data,status:"idle"}:"condition"===n.type?{...n.data,if:[{[null!==(o=null==n?void 0:null===(a=n.data)||void 0===a?void 0:a.operator)&&void 0!==o?o:"=="]:[{var:"payload"},"idle"]}],value:null}:"sensor"===n.type?{...n.data,value:"idle"}:{...n.data}};return{nodes:[...e.nodes,i]}}),e({contextMenu:null})},onDrop:(a,o)=>{var n;a.preventDefault();let i=null===(n=o.current)||void 0===n?void 0:n.getBoundingClientRect(),l=a.dataTransfer.getData("application/fintech-automation");if(!l)return;let r={x:i?a.clientX-i.left:0,y:i?a.clientY-i.top:0},s={id:"".concat(l,"-").concat(Date.now()),type:l,position:r,data:{eventTrigger:{label:"Event Trigger",source:"stripe",eventType:null,isActive:!1},dateTime:{label:"Schedule",time:"09:00",date:"",isActive:!1,repeat:!1,activeDays:[]},condition:{label:"Condition",if:[{"==":[{var:"payload"},""]}],operator:"=="},filter:{label:"Filter",operator:"==",filterValue:0,valueType:"number"},timeout:{label:"Delay",duration:5e3,isActive:!1,remainingTime:0},approval:{label:"Approval Required",approverRole:"admin",timeoutHours:24,message:"",status:"idle"},rateLimit:{label:"Rate Limit",limit:10,timeUnit:"minute",burstAllowance:0,currentCount:0,status:"idle"},notification:{label:"Notification",channel:"email",template:"",recipient:"",status:"idle"},webhook:{label:"Webhook",url:"",method:"POST",headers:{},body:"",status:"idle"},auditLog:{label:"Audit Log",action:"",severity:"info",description:"",metadata:{},status:"idle"},debugger:{label:"Debugger",logs:[],isActive:!0,logLevel:"info",autoScroll:!0},"ai-analysis":{label:"AI Analysis",instruction:"",result:"",isProcessing:!1}}[l]||{label:"".concat(l," Node")}};e({nodes:[...t().nodes,s]})},clearAutomation:()=>{e({nodes:[],edges:[]})},onMoreDetails:t=>{e(e=>({nodeDetails:e.nodes.find(e=>e.id===t),contextMenu:null}))},closeMoreDetails:()=>{e({nodeDetails:null})},updateNodeData:(t,a)=>{e(e=>({nodes:e.nodes.map(e=>e.id===t?{...e,data:{...e.data,...a}}:e)}))},getSourceNodes:e=>{let a=Array.isArray(t().edges)?t().edges:[];return a&&e?a.filter(t=>t.target===e).map(e=>t().nodes.find(t=>t.id===e.source)).filter(Boolean):[]},getTargetNodes:e=>{let{nodes:a,edges:o}=t();return o.filter(t=>t.source===e).map(e=>a.find(t=>t.id===e.target)).filter(Boolean)}}))}}]);