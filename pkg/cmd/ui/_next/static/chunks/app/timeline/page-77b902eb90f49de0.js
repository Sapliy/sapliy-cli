(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[404],{7871:(e,t,s)=>{Promise.resolve().then(s.bind(s,2600))},2600:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>y});var r=s(5155),n=s(2115),l=s(6233),a=s(5620),o=s(4081),i=s(8236),c=s(6745),d=s(1773),u=s(6889);let m=e=>{let{url:t,onEvent:s,onError:r,onConnect:l,onDisconnect:a,autoReconnect:o=!0,reconnectInterval:i=5e3}=e,c=(0,n.useRef)(null),d=(0,n.useRef)(null),[u,m]=(0,n.useState)(!1),[x,h]=(0,n.useState)([]),[g,p]=(0,n.useState)(null),v=(0,n.useCallback)(()=>{h([])},[]),f=(0,n.useCallback)(()=>{d.current&&(clearTimeout(d.current),d.current=null),c.current&&(c.current.close(),c.current=null),m(!1)},[]),y=(0,n.useCallback)(()=>{c.current&&c.current.close();try{let e=new WebSocket(t);c.current=e,e.onopen=()=>{console.log("[EventStream] Connected to event stream"),m(!0),p(null),null==l||l()},e.onmessage=e=>{try{let t=JSON.parse(e.data);console.log("[EventStream] Received event:",t.type),h(e=>[t,...e].slice(0,100)),null==s||s(t)}catch(e){console.error("[EventStream] Failed to parse event:",e)}},e.onerror=e=>{console.error("[EventStream] WebSocket error:",e);let t=Error("WebSocket connection error");p(t),null==r||r(t)},e.onclose=()=>{console.log("[EventStream] Disconnected from event stream"),m(!1),null==a||a(),o&&(console.log("[EventStream] Reconnecting in ".concat(i,"ms...")),d.current=setTimeout(()=>{y()},i))}}catch(t){let e=t instanceof Error?t:Error("Failed to connect");p(e),null==r||r(e)}},[t,s,r,l,a,o,i]);return(0,n.useEffect)(()=>(y(),()=>{f()}),[]),{isConnected:u,events:x,error:g,connect:y,disconnect:f,clearEvents:v}};var x=s(5683),h=s(7112),g=s(8621),p=s(1099),v=s(2818);let f=e=>{let{source:t}=e;switch(t){case"stripe":return(0,r.jsx)(l.A,{className:"w-5 h-5 text-indigo-500"});case"wallet":return(0,r.jsx)(a.A,{className:"w-5 h-5 text-emerald-500"});case"ledger":return(0,r.jsx)(o.A,{className:"w-5 h-5 text-gray-500"});case"system":return(0,r.jsx)(i.A,{className:"w-5 h-5 text-orange-500"});default:return(0,r.jsx)(c.A,{className:"w-5 h-5 text-blue-500"})}};function y(){let{events:e,connect:t,isConnected:s,clearEvents:l}=m({url:"ws://localhost:8080/events/stream",autoReconnect:!0}),a=(0,n.useRef)(null),{zone:o}=(0,g.n)(),{addToast:i}=(0,p.A)(),y=async e=>{if(o)try{let t=v.env.NEXT_PUBLIC_FLOW_SERVICE_URL||"http://localhost:8084";(await fetch("".concat(t,"/api/v1/events/").concat(e.id,"/replay"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({zoneId:o.id})})).ok?i({title:"Success",description:"Event replayed successfully",status:"success",position:"top-right"}):i({title:"Error",description:"Failed to replay event",status:"error",position:"top-right"})}catch(e){i({title:"Error",description:"Error replaying event",status:"error",position:"top-right"}),console.error("Error replaying event:",e)}};return(0,n.useEffect)(()=>{a.current&&(a.current.scrollTop=0)},[e]),(0,r.jsxs)("div",{className:"flex flex-col h-full w-full bg-gray-50",children:[(0,r.jsxs)("div",{className:"bg-white border-b border-gray-200 px-8 py-6 flex justify-between items-center",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("div",{className:"p-3 rounded-lg ".concat(s?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-400"),children:(0,r.jsx)(c.A,{className:"w-6 h-6"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Event Timeline"}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[(0,r.jsx)("span",{className:"w-2 h-2 rounded-full ".concat(s?"bg-green-500":"bg-red-500")}),s?"Connected to Event Stream":"Disconnected"]})]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:l,className:"px-4 py-2 text-sm font-medium text-gray-600 hover:bg-gray-100 rounded-lg transition-colors border border-gray-200",children:"Clear"}),!s&&(0,r.jsxs)("button",{onClick:t,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors flex items-center gap-2",children:[(0,r.jsx)(d.A,{className:"w-4 h-4"}),"Reconnect"]})]})]}),(0,r.jsx)("div",{className:"flex-1 overflow-hidden relative",children:(0,r.jsx)("div",{ref:a,className:"h-full overflow-y-auto p-8 space-y-4",children:(0,r.jsx)(x.N,{initial:!1,children:0===e.length?(0,r.jsxs)("div",{className:"text-center py-20 text-gray-400",children:[(0,r.jsx)(c.A,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),(0,r.jsx)("p",{children:"Waiting for events..."})]}):e.map(e=>(0,r.jsx)(h.P.div,{initial:{opacity:0,y:-20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.3},className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4 hover:shadow-md transition-shadow",children:(0,r.jsxs)("div",{className:"flex items-start gap-4",children:[(0,r.jsx)("div",{className:"p-2 bg-gray-50 rounded-lg border border-gray-100",children:(0,r.jsx)(f,{source:e.source})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.type,(0,r.jsx)("span",{className:"px-2 py-0.5 rounded-full bg-blue-50 text-blue-700 text-xs font-mono font-medium",children:e.source})]}),(0,r.jsxs)("p",{className:"text-sm text-gray-500 mt-0.5 font-mono text-xs",children:["ID: ",e.id]})]}),(0,r.jsxs)("div",{className:"flex flex-col items-end gap-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1 text-xs text-gray-400",children:[(0,r.jsx)(u.A,{className:"w-3 h-3"}),new Date(e.timestamp).toLocaleTimeString()]}),(0,r.jsxs)("button",{onClick:()=>y(e),className:"flex items-center gap-1 px-2 py-1 bg-blue-50 text-blue-600 rounded hover:bg-blue-100 transition-colors text-xs font-medium",title:"Replay this event",children:[(0,r.jsx)(d.A,{className:"w-3 h-3"}),"Replay"]})]})]}),(0,r.jsx)("div",{className:"mt-3 bg-gray-50 rounded-lg p-3 font-mono text-xs text-gray-700 overflow-x-auto border border-gray-200",children:(0,r.jsx)("pre",{children:JSON.stringify(e.payload,null,2)})})]})]})},e.id))})})})]})}},8621:(e,t,s)=>{"use strict";s.d(t,{n:()=>a});var r=s(9827),n=s(709);let l={admin:4,finance:3,developer:2,viewer:1},a=(0,r.v)()((0,n.Zr)((e,t)=>({user:null,organization:null,zone:null,zones:[],environment:"test",accessToken:null,isLoading:!1,error:null,setUser:t=>e({user:t}),setOrganization:t=>e({organization:t}),setZone:t=>e({zone:t,environment:(null==t?void 0:t.mode)||"test"}),setZones:t=>e({zones:t}),setEnvironment:t=>e({environment:t}),setAccessToken:t=>e({accessToken:t}),setLoading:t=>e({isLoading:t}),setError:t=>e({error:t}),login:async(e,s)=>{let{setLoading:r,setError:n,setUser:l,setAccessToken:a}=t();r(!0),n(null);try{let t=await fetch("".concat("http://localhost:3000/api/auth","/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:s})});if(!t.ok)throw Error("Invalid credentials");let r=await t.json();a(r.access_token),l({id:r.user.id,email:r.user.email,name:r.user.name||e.split("@")[0],role:r.user.role||"developer"})}catch(e){throw n(e instanceof Error?e.message:"Login failed"),e}finally{r(!1)}},logout:()=>{e({user:null,organization:null,zone:null,zones:[],accessToken:null,error:null})},hasRole:e=>{let{user:s}=t();return!!s&&l[s.role]>=l[e]},canEdit:()=>{let{user:e}=t();return!!e&&["admin","finance","developer"].includes(e.role)},isAdmin:()=>{let{user:e}=t();return(null==e?void 0:e.role)==="admin"}}),{name:"fintech-auth-storage",partialize:e=>({accessToken:e.accessToken,user:e.user,organization:e.organization,zone:e.zone,zones:e.zones,environment:e.environment})}))},1099:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(9827).v)(e=>({toasters:[],addToast:t=>{let s=Math.random().toString(36).substr(2,9);e(e=>({toasters:[...e.toasters,{...t,id:s}]}))},removeToast:t=>{e(e=>({toasters:e.toasters.filter(e=>e.id!==t)}))}}))}},e=>{var t=t=>e(e.s=t);e.O(0,[498,113,441,517,358],()=>t(7871)),_N_E=e.O()}]);